command,type,content
"/start","text","Welcome to ROM Request Bot!\n\nUse /request to submit a ROM request.\nUse /myrequests to see your requests.\nIf you need priority handling use /pay_priority.\n\nContact admin: -1003032073306"
"/help","text","Commands:\n/request - submit ROM request\n/myrequests - show your requests\n/pay_priority - pay for priority\n/status - check last request status"
"/request","bjs","// /request - multi-step form\nBot.sendMessage(\"Let's create your ROM request. Reply with the device codename (e.g. 'sunstone'):\");\nBot.waitForText(function(step1) {\n  var device = step1.message;\n  Bot.sendMessage(\"ROM name / version:\");\n  Bot.waitForText(function(step2) {\n    var rom = step2.message;\n    Bot.sendMessage(\"Short notes (what's broken / what you need). If you want to attach a file, send it now or type /skip:\");\n    Bot.waitForAny(function(step3) {\n      var notes = (step3.message || \"\").trim();\n      var fileInfo = null;\n      if(step3.document || step3.photo || step3.audio) {\n        fileInfo = step3;\n      }\n      var req = {\n        device: device,\n        rom: rom,\n        notes: notes || \"â€”\",\n        user_id: step1.user.telegramid,\n        username: step1.user.username || \"\",\n        firstname: step1.user.first_name || \"\",\n        created_at: (new Date()).toISOString(),\n        status: \"pending\",\n        priority: false\n      };\n      var all = Bot.getVar(\"all_requests\") || [];\n      all.push(req);\n      Bot.setVar(\"all_requests\", all);\n      var key = \"requests_\" + step1.user.telegramid;\n      var userList = Bot.getVar(key) || [];\n      userList.push(req);\n      Bot.setVar(key, userList);\n      Bot.sendMessage(\"âœ… Your request has been saved. We'll notify admin. You can view with /myrequests\");\n      var adminTarget = \"-1003032073306\";\n      var text = \"ðŸ“¥ *New ROM Request*\\n\\n*Device:* \" + device + \"\\n*ROM:* \" + rom + \"\\n*From:* \" + req.firstname + \" (@\" + (req.username || \"no_username\") + \")\" + \"\\n*When:* \" + req.created_at + \"\\n\\n*Notes:*\\n\" + req.notes;\n      try {\n        Bot.sendInlineKeyboard([\n          {title: \"Accept\", command: \"/admin_accept \" + req.user_id + \"|\" + device + \"|\" + rom},\n          {title: \"Reject\", command: \"/admin_reject \" + req.user_id},\n          {title: \"Ask\", command: \"/admin_ask \" + req.user_id},\n          {title: \"Set Priority\", command: \"/admin_setpriority \" + req.user_id}\n        ], text, {parse_mode: \"Markdown\"});\n      } catch(e) {\n        Bot.sendMessageTo(adminTarget, text, {parse_mode: \"Markdown\"});\n        Bot.sendMessageTo(adminTarget, \"Use admin commands to manage: /admin_list, /admin_accept <userId>|<device>|<rom>, /admin_reject <userId>\");\n      }\n      if(fileInfo) {\n        try {\n          Bot.forwardMessage(adminTarget, step3.chat.id, fileInfo.message_id);\n        } catch(err) {\n          Bot.sendMessageTo(adminTarget, \"User included a file but forwarding failed. Ask user for file.\");\n        }\n      }\n    }, 180000);\n  });\n});"
"/myrequests","bjs","// Show user requests\nvar key = \"requests_\" + request.user.telegramid;\nvar arr = Bot.getVar(key) || [];\nif(arr.length == 0){\n  Bot.sendMessage(\"You have no requests yet. Use /request to create one.\");\n}else{\n  var out = \"Your requests:\\n\\n\";\n  for(var i=0;i<arr.length;i++){\n    var r = arr[i];\n    out += (i+1) + \". \" + r.device + \" â€” \" + r.rom + \" (\" + r.status + (r.priority ? \" | PRIORITY\" : \"\") + \")\\nCreated: \" + r.created_at + \"\\n\\n\";\n  }\n  Bot.sendMessage(out);\n}"
"/cancel","text","If you're in a flow, use the app's cancel button or send /cancel to stop. Operation cancelled."
"/pay_priority","bjs","// /pay_priority - simplified flow to generate an invoice link\nBot.sendMessage(\"Priority costs $5. Type the number of the request you want to mark as priority (from /myrequests), or type 'cancel' to exit.\");\nBot.waitForText(function(ans) {\n  var choice = ans.message.trim();\n  if(choice.toLowerCase() == \"cancel\") { Bot.sendMessage(\"Cancelled\"); return; }\n  var idx = parseInt(choice) - 1;\n  var key = \"requests_\" + ans.user.telegramid;\n  var arr = Bot.getVar(key) || [];\n  if(!arr[idx]){ Bot.sendMessage(\"Invalid request number.\"); return; }\n  var req = arr[idx];\n  var invoiceUrl = \"https://example.com/pay?user=\" + ans.user.telegramid + \"&req=\" + idx + \"&amount=5\";\n  Bot.sendMessage(\"Open this link to pay for priority (this is a placeholder):\\n\" + invoiceUrl + \"\\n\\nAfter payment, admin or you must run /pay_verify to mark it paid (or integrate webhook).\");\n  Bot.setVar(\"invoice_pending_\" + ans.user.telegramid + \"_\" + idx, {invoice_url: invoiceUrl, amount:5});\n});"
"/pay_verify","bjs","// /pay_verify - helper to mark invoice paid (user or admin can run for demo)\nvar parts = request.message.split(\" \");\nif(parts.length < 2){ Bot.sendMessage(\"Usage: /pay_verify <request_number> (use your own request number)\"); return; }\nvar idx = parseInt(parts[1]) - 1;\nvar key = \"requests_\" + request.user.telegramid;\nvar arr = Bot.getVar(key) || [];\nif(!arr[idx]){ Bot.sendMessage(\"Request not found.\"); return; }\narr[idx].priority = true;\narr[idx].status = \"priority_paid\";\nBot.setVar(key, arr);\nvar all = Bot.getVar(\"all_requests\") || [];\nfor(var i=0;i<all.length;i++){ if(all[i].user_id == request.user.telegramid && all[i].device == arr[idx].device && all[i].rom == arr[idx].rom){ all[i].priority = true; all[i].status = \"priority_paid\"; } }\nBot.setVar(\"all_requests\", all);\nBot.sendMessage(\"Marked request #\" + (idx+1) + \" as PRIORITY. Admin will be notified.\");\nvar adminTarget = \"-1003032073306\";\nBot.sendMessageTo(adminTarget, \"ðŸ”” Priority payment received for user: @\" + (request.user.username || \"\") + \" Request: \" + arr[idx].device + \" - \" + arr[idx].rom);"
"/status","bjs","// Show status of last request\nvar key = \"requests_\" + request.user.telegramid;\nvar arr = Bot.getVar(key) || [];\nif(arr.length == 0){ Bot.sendMessage(\"No requests found.\"); return; }\nvar last = arr[arr.length-1];\nvar out = \"Last request:\\nDevice: \" + last.device + \"\\nROM: \" + last.rom + \"\\nStatus: \" + last.status + (last.priority ? \" (PRIORITY)\" : \"\") + \"\\nCreated: \" + last.created_at;\nBot.sendMessage(out);"
"/admin","text","Admin panel. Use admin commands. Admin channel: -1003032073306"
"/admin_list","bjs","// List pending requests (admin)\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar all = Bot.getVar(\"all_requests\") || [];\nif(all.length == 0){ Bot.sendMessage(\"No requests.\"); return; }\nvar out = \"All requests:\\n\\n\";\nfor(var i=0;i<all.length;i++){\n  var r = all[i];\n  out += (i+1) + \". \" + r.device + \" - \" + r.rom + \" | from: \" + r.firstname + \" (@\" + (r.username||\"\") + \") | status: \" + r.status + (r.priority ? \" | PRIORITY\" : \"\") + \"\\n\";\n}\nBot.sendMessage(out);"
"/admin_accept","bjs","// /admin_accept <userId>|<device>|<rom>\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar params = request.message.split(\" \").slice(1).join(\" \");\nvar parts = params.split(\"|\");\nvar userId = parts[0];\nvar device = parts[1] || \"\";\nvar rom = parts[2] || \"\";\nvar all = Bot.getVar(\"all_requests\") || [];\nfor(var i=0;i<all.length;i++){ if(all[i].user_id == userId && all[i].device == device && all[i].rom == rom){ all[i].status = \"accepted\"; } }\nBot.setVar(\"all_requests\", all);\nvar key = \"requests_\" + userId;\nvar arr = Bot.getVar(key) || [];\nfor(var j=0;j<arr.length;j++){ if(arr[j].device == device && arr[j].rom == rom){ arr[j].status = \"accepted\"; } }\nBot.setVar(key, arr);\nBot.sendMessage(\"Marked accepted and notified user.\");\nBot.sendMessageTo(userId, \"âœ… Your ROM request for \" + device + \" / \" + rom + \" has been *accepted* by admin. We'll contact you in PM. Thanks!\", {parse_mode:\"Markdown\"});"
"/admin_reject","bjs","// /admin_reject <userId>\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar parts = request.message.split(\" \");\nvar userId = parts[1];\nif(!userId){ Bot.sendMessage(\"Usage: /admin_reject <userId>\"); return; }\nvar key = \"requests_\" + userId;\nvar arr = Bot.getVar(key) || [];\nif(arr.length == 0){ Bot.sendMessage(\"No requests for that user\"); return; }\narr[arr.length-1].status = \"rejected\";\nBot.setVar(key, arr);\nvar all = Bot.getVar(\"all_requests\") || [];\nfor(var i=0;i<all.length;i++){ if(all[i].user_id == userId){ all[i].status = \"rejected\"; } }\nBot.setVar(\"all_requests\", all);\nBot.sendMessage(\"Marked rejected and notified user.\");\nBot.sendMessageTo(userId, \"âŒ Your last ROM request has been rejected by admin. For details contact admin.\");"
"/admin_ask","bjs","// /admin_ask <userId> - admin asks user for more info\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar parts = request.message.split(\" \");\nvar userId = parts[1];\nif(!userId){ Bot.sendMessage(\"Usage: /admin_ask <userId>\"); return; }\nBot.sendMessage(\"What do you want to ask?\");\nBot.waitForText(function(ans) {\n  var question = ans.message;\n  Bot.sendMessageTo(userId, \"ðŸ’¬ Admin asks: \" + question);\n  Bot.sendMessage(\"Sent.\");\n});"
"/admin_setpriority","bjs","// /admin_setpriority <userId>\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar parts = request.message.split(\" \");\nvar userId = parts[1];\nif(!userId){ Bot.sendMessage(\"Usage: /admin_setpriority <userId>\"); return; }\nvar key = \"requests_\" + userId;\nvar arr = Bot.getVar(key) || [];\nif(arr.length == 0){ Bot.sendMessage(\"No requests for that user\"); return; }\narr[arr.length-1].priority = true;\narr[arr.length-1].status = \"priority_manually_set\";\nBot.setVar(key, arr);\nvar all = Bot.getVar(\"all_requests\") || [];\nfor(var i=0;i<all.length;i++){ if(all[i].user_id == userId){ all[i].priority = true; all[i].status = \"priority_manually_set\"; } }\nBot.setVar(\"all_requests\", all);\nBot.sendMessage(\"Request marked as priority.\");"
"/admin_broadcast","bjs","// Broadcast to all users (admin only)\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nBot.sendMessage(\"Type the message to broadcast:\");\nBot.waitForText(function(ans) {\n  var msg = ans.message;\n  var all = Bot.getVar(\"all_requests\") || [];\n  var sent = 0;\n  var seen = {};\n  for(var i=0;i<all.length;i++){ if(all[i].user_id && !seen[all[i].user_id]){ Bot.sendMessageTo(all[i].user_id, msg); seen[all[i].user_id]=true; sent++; } }\n  Bot.sendMessage(\"Broadcast sent to \" + sent + \" users.\");\n});"
"/admin_users","bjs","// admin users count\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar all = Bot.getVar(\"all_requests\") || [];\nvar seen = {};\nfor(var i=0;i<all.length;i++){ if(all[i].user_id){ seen[all[i].user_id]=true; } }\nvar count = Object.keys(seen).length;\nBot.sendMessage(\"Total users with requests: \" + count);"
"/admin_requests","bjs","// total request count admin\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar all = Bot.getVar(\"all_requests\") || [];\nBot.sendMessage(\"Total requests: \" + all.length);"
"/admin_help","text","Admin commands: /admin_list, /admin_accept, /admin_reject, /admin_ask, /admin_setpriority, /admin_broadcast, /admin_users, /admin_requests"
"/admin_delete","bjs","// admin delete last request of a user\nif(request.user.telegramid != 5551637469){ Bot.sendMessage(\"Not allowed\"); return; }\nvar parts = request.message.split(\" \");\nvar userId = parts[1];\nif(!userId){ Bot.sendMessage(\"Usage: /admin_delete <userId>\"); return; }\nvar key = \"requests_\" + userId;\nvar arr = Bot.getVar(key) || [];\nif(arr.length == 0){ Bot.sendMessage(\"No requests for that user\"); return; }\nvar removed = arr.pop();\nBot.setVar(key, arr);\nvar all = Bot.getVar(\"all_requests\") || [];\nfor(var i=all.length-1;i>=0;i--){ if(all[i].user_id == userId && all[i].device == removed.device && all[i].rom == removed.rom){ all.splice(i,1); } }\nBot.setVar(\"all_requests\", all);\nBot.sendMessage(\"Deleted last request for user \" + userId);"
