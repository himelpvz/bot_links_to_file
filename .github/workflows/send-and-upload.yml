name: Pixeldrain â†’ Download & Upload to Telegram

on:
  workflow_dispatch:
    inputs:
      pixeldrain_link:
        description: 'Pixeldrain link (optional, fallback to secret PIXEL_LINK)'
        required: false
      chat_id:
        description: 'Telegram chat id (optional, fallback to secret TELEGRAM_CHAT_ID)'
        required: false
      max_upload_gb:
        description: 'Max upload size (GB). Example: 2'
        required: false

jobs:
  upload:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install tools
        run: sudo apt-get update && sudo apt-get install -y zip wget curl

      - name: Run script
        env:
          PIXEL_LINK: ${{ github.event.inputs.pixeldrain_link != '' && github.event.inputs.pixeldrain_link || secrets.PIXEL_LINK }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ github.event.inputs.chat_id != '' && github.event.inputs.chat_id || secrets.TELEGRAM_CHAT_ID }}
          MAX_UPLOAD_GB: ${{ github.event.inputs.max_upload_gb }}
        run: |
          node ./send_and_upload.js
